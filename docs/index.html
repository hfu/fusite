<!DOCTYPE html>
<html lang='ja'>

<head>
    <meta charset="utf-8" />
    <title>fusi - 国土地理院標高タイル可視化</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="国土地理院の標高データを WebP Terrarium タイルとして可視化" />
    
    <!-- MapLibre GL JS -->
    <script src="https://unpkg.com/maplibre-gl@5.7.0/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@5.7.0/dist/maplibre-gl.css" rel="stylesheet" />
    
    <link href="style.css" rel="stylesheet" />
</head>

<body>
    <div id="map"></div>
    
    <div class="info-panel">
        <h1>fusi 標高タイル</h1>
        <p>国土地理院の標高データを Terrarium 形式で可視化</p>
        <p class="attribution">
            データ: <a href="https://www.gsi.go.jp/" target="_blank" rel="noopener noreferrer">国土地理院 (GSI Japan)</a><br>
            測量法に基づく国土地理院長承認（使用）R 6JHs 133<br>
            <br>
            Inspired by <a href="https://github.com/mapterhorn/mapterhorn" target="_blank" rel="noopener noreferrer">Mapterhorn</a><br>
            Made with <a href="https://github.com/hfu/fusi" target="_blank" rel="noopener noreferrer">fusi</a>
        </p>
    </div>
    
    <script type="text/javascript">
        // Initialize map with 3D terrain visualization
        const map = new maplibregl.Map({
            container: 'map',
            hash: 'map',
            zoom: 9,
            center: [138.7292, 35.3628], // Mount Fuji
            pitch: 60,
            bearing: 0,
            maxPitch: 85,
            style: {
                version: 8,
                glyphs: 'https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf',
                sources: {
                    fusiTerrain: {
                        type: 'raster-dem',
                        tiles: ['https://tunnel.optgeo.org/martin/fusi/{z}/{x}/{y}'],
                        encoding: 'terrarium',
                        tileSize: 512,
                        minzoom: 0,
                        maxzoom: 16
                    }
                },
                layers: [
                    {
                        id: 'background',
                        type: 'background',
                        paint: {
                            'background-color': '#e0e0e0'
                        }
                    },
                    {
                        id: 'hillshade',
                        type: 'hillshade',
                        source: 'fusiTerrain',
                        paint: {
                            // 光沢感を高めるための近似設定（多方向法が使えない標準MapLibre想定）
                            // 暖色系ハイライト + 寒色寄りシャドウで陰影コントラストを強調
                            'hillshade-exaggeration': 0.2,
                            'hillshade-highlight-color': 'rgb(255,255,235)',
                            'hillshade-shadow-color': 'rgb(110,120,130)'
                        }
                    }
                ],
                terrain: {
                    source: 'fusiTerrain'
                }
            }
        });

        // Add navigation controls
        map.addControl(new maplibregl.NavigationControl({
            visualizePitch: true,
            showZoom: true,
            showCompass: true
        }), 'top-right');

        // Add GSI attribution to map controls
        map.on('load', () => {
            const attributionControl = document.querySelector('.maplibregl-ctrl-attrib-inner');
            if (attributionControl && !attributionControl.innerHTML.includes('国土地理院')) {
                attributionControl.innerHTML += ' | データ: <a href="https://www.gsi.go.jp/" target="_blank" rel="noopener noreferrer">国土地理院 (GSI Japan)</a> R 6JHs 133';
            }
        });
    </script>
</body>

</html>
