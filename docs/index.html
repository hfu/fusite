<!DOCTYPE html>
<html lang='ja'>

<head>
    <meta charset="utf-8" />
    <title>fusi - 国土地理院標高タイル可視化</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="国土地理院の標高データを WebP Terrarium タイルとして可視化" />
    
    <!-- MapLibre GL JS -->
    <script src="https://unpkg.com/maplibre-gl@5.7.0/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@5.7.0/dist/maplibre-gl.css" rel="stylesheet" />
    
    <link href="style.css" rel="stylesheet" />
</head>

<body>
    <div id="map"></div>
    
    <div class="info-panel">
        <h1>fusi 標高タイル</h1>
        <p>国土地理院の標高データを Terrarium 形式で可視化</p>
        <p class="attribution">
            データ: <a href="https://www.gsi.go.jp/" target="_blank" rel="noopener noreferrer">国土地理院 (GSI Japan)</a><br>
            測量法に基づく国土地理院長承認（使用）R 6JHs 133<br>
            <br>
            Inspired by <a href="https://github.com/mapterhorn/mapterhorn" target="_blank" rel="noopener noreferrer">Mapterhorn</a><br>
            Made with <a href="https://github.com/hfu/fusi" target="_blank" rel="noopener noreferrer">fusi</a>
        </p>
    </div>
    
    <script type="text/javascript">
        // Initialize map with 3D terrain visualization
        const map = new maplibregl.Map({
            container: 'map',
            hash: true,
            zoom: 14.74,
            center: [129.87255, 32.75055],
            pitch: 16.2,
            bearing: 6,
            maxPitch: 85,
            style: {
                version: 8,
                glyphs: 'https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf',
                sources: {
                    fusiTerrain: {
                        type: 'raster-dem',
                        tiles: ['https://tunnel.optgeo.org/martin/fusi/{z}/{x}/{y}'],
                        encoding: 'terrarium',
                        tileSize: 512,
                        minzoom: 0,
                        maxzoom: 16
                    },
                    bvmap: {
                        type: 'vector',
                        url: 'https://tunnel.optgeo.org/martin/bvmap'
                    }
                },
                layers: [
                    {
                        id: 'background',
                        type: 'background',
                        paint: {
                            'background-color': '#e0e0e0'
                        }
                    },
                    {
                        id: 'hillshade',
                        type: 'hillshade',
                        source: 'fusiTerrain',
                        paint: {
                            // 光沢感を高めるための近似設定（多方向法が使えない標準MapLibre想定）
                            // 暖色系ハイライト + 寒色寄りシャドウで陰影コントラストを強調
                            'hillshade-exaggeration': 0.2,
                            'hillshade-highlight-color': 'rgb(255,255,235)',
                            'hillshade-shadow-color': 'rgb(110,120,130)'
                        }
                    },
                    {
                        id: '行政区画',
                        type: 'fill',
                        source: 'bvmap',
                        'source-layer': 'AdmArea',
                        paint: {
                            'fill-color': 'rgba(255,255,255,0)',
                            'fill-outline-color': 'rgba(110,120,130,1)'
                        }
                    },
                    {
                        id: '水域',
                        maxzoom: 17,
                        type: 'fill',
                        source: 'bvmap',
                        'source-layer': 'WA',
                        paint: {
                            'fill-color': 'rgba(0,0,0,0)',
                            'fill-outline-color': 'rgba(110,120,130,1)'
                        }
                    },
                    {
                        id: '地形表記面',
                        type: 'fill',
                        source: 'bvmap',
                        maxzoom: 17,
                        'source-layer': 'TpgphArea',
                        paint: {
                            'fill-color': 'rgba(0,0,0,0)',
                            'fill-outline-color': 'rgba(110,120,130,1)'
                        }
                    },
                    {
                        id: '地形表記面2',
                        type: 'fill',
                        source: 'bvmap',
                        'source-layer': 'TpgphArea',
                        minzoom: 17,
                        filter: [
                            'in',
                            ['get', 'vt_flag17'],
                            ['literal', [1, 2]]
                        ],
                        paint: {
                            'fill-color': 'rgba(0,0,0,0)',
                            'fill-outline-color': 'rgba(110,120,130,1)'
                        }
                    },
                    {
                        id: '海岸線',
                        type: 'line',
                        source: 'bvmap',
                        'source-layer': 'Cstline',
                        paint: {
                            'line-color': 'rgba(110,120,130,1)',
                            'line-width': 1
                        }
                    },
                    {
                        id: '河川_線',
                        type: 'line',
                        source: 'bvmap',
                        'source-layer': 'RvrCL',
                        paint: {
                            'line-color': 'rgba(110,120,130,1)',
                            'line-width': 1
                        }
                    },
                    {
                        id: '水涯線',
                        type: 'line',
                        source: 'bvmap',
                        'source-layer': 'WL',
                        paint: {
                            'line-color': 'rgba(110,120,130,1)',
                            'line-width': 1
                        }
                    },
                    {
                        id: '水部表記線polygon',
                        type: 'fill',
                        source: 'bvmap',
                        'source-layer': 'WRltLine',
                        filter: [
                            '==',
                            ['geometry-type'],
                            'Polygon'
                        ],
                        paint: {
                            'fill-color': 'rgba(255,255,255,0)',
                            'fill-outline-color': 'rgba(110,120,130,1)'
                        }
                    },
                    {
                        id: '水部表記線line',
                        type: 'line',
                        source: 'bvmap',
                        'source-layer': 'WRltLine',
                        filter: [
                            '==',
                            ['geometry-type'],
                            'LineString'
                        ],
                        paint: {
                            'line-color': 'rgba(110,120,130,1)',
                            'line-width': 1
                        }
                    },
                    {
                        id: '行政区画界線',
                        type: 'line',
                        source: 'bvmap',
                        'source-layer': 'AdmBdry',
                        paint: {
                            'line-color': 'rgba(110,120,130,1)',
                            'line-width': 1
                        }
                    },
                    {
                        id: '等深線',
                        type: 'line',
                        source: 'bvmap',
                        'source-layer': 'Isbt',
                        paint: {
                            'line-color': 'rgba(110,120,130,1)',
                            'line-width': 1
                        }
                    },
                    {
                        id: '水部構造物面',
                        type: 'fill',
                        source: 'bvmap',
                        'source-layer': 'WStrA',
                        paint: {
                            'fill-color': 'rgba(0,0,0,0)',
                            'fill-outline-color': 'rgba(110,120,130,1)'
                        }
                    },
                    {
                        id: '水部構造物線',
                        type: 'line',
                        source: 'bvmap',
                        'source-layer': 'WStrL',
                        maxzoom: 17,
                        filter: [
                            'any',
                            ['!', ['has', 'vt_flag17']],
                            ['in', ['get', 'vt_flag17'], ['literal', [0, 1]]]
                        ],
                        paint: {
                            'line-color': 'rgba(110,120,130,1)',
                            'line-width': 1
                        }
                    },
                    {
                        id: '水部構造物線2',
                        type: 'line',
                        source: 'bvmap',
                        'source-layer': 'WStrL',
                        minzoom: 17,
                        filter: [
                            'in',
                            ['get', 'vt_flag17'],
                            ['literal', [1, 2]]
                        ],
                        paint: {
                            'line-color': 'rgba(110,120,130,1)',
                            'line-width': 1
                        }
                    },
                    {
                        id: '道路_線',
                        type: 'line',
                        source: 'bvmap',
                        'source-layer': 'RdCL',
                        maxzoom: 17,
                        paint: {
                            'line-color': [
                                'case',
                                ['==', ['get', 'vt_rnkwidth'], '不明'],
                                'rgba(255,255,255,0)',
                                'rgba(110,120,130,1)'
                            ],
                            'line-width': 1
                        }
                    },
                    {
                        id: '道路_線2',
                        type: 'line',
                        source: 'bvmap',
                        'source-layer': 'RdCL',
                        minzoom: 17,
                        filter: [
                            'all',
                            ['in', ['get', 'vt_flag17'], ['literal', [1, 2]]]
                        ],
                        paint: {
                            'line-color': 'rgba(110,120,130,1)',
                            'line-width': 1
                        }
                    },
                    {
                        id: '鉄道_線',
                        maxzoom: 17,
                        type: 'line',
                        source: 'bvmap',
                        'source-layer': 'RailCL',
                        paint: {
                            'line-color': 'rgba(110,120,130,1)',
                            'line-width': 1
                        }
                    },
                    {
                        id: '鉄道_線2',
                        minzoom: 17,
                        type: 'line',
                        source: 'bvmap',
                        'source-layer': 'RailCL',
                        filter: [
                            'all',
                            ['in', ['get', 'vt_flag17'], ['literal', [1, 2]]]
                        ],
                        paint: {
                            'line-color': 'rgba(110,120,130,1)',
                            'line-width': 1
                        }
                    },
                    {
                        id: '建築物_外周線',
                        type: 'line',
                        source: 'bvmap',
                        'source-layer': 'BldA',
                        paint: {
                            'line-color': 'rgba(110,120,130,1)',
                            'line-width': 1
                        }
                    },
                    {
                        id: '地下駅',
                        type: 'fill',
                        source: 'bvmap',
                        'source-layer': 'UndergroundStation',
                        paint: {
                            'fill-color': 'rgba(0,0,0,0)',
                            'fill-outline-color': 'rgba(110,120,130,1)'
                        }
                    },
                    {
                        id: '道路縁',
                        minzoom: 17,
                        type: 'line',
                        source: 'bvmap',
                        'source-layer': 'RdEdg',
                        paint: {
                            'line-color': 'rgba(110,120,130,1)',
                            'line-width': 1
                        }
                    },
                    {
                        id: '道路構成線',
                        minzoom: 17,
                        type: 'line',
                        source: 'bvmap',
                        'source-layer': 'RdCompt',
                        paint: {
                            'line-color': 'rgba(110,120,130,1)',
                            'line-width': 1
                        }
                    },
                    {
                        id: '軌道_線',
                        minzoom: 17,
                        type: 'line',
                        source: 'bvmap',
                        'source-layer': 'RailTrCL',
                        layout: {
                            'line-sort-key': ['get', 'vt_drworder']
                        },
                        paint: {
                            'line-color': 'rgba(110,120,130,1)',
                            'line-width': 1
                        }
                    },
                    {
                        id: '特定地区界',
                        type: 'line',
                        source: 'bvmap',
                        'source-layer': 'SpcfArea',
                        paint: {
                            'line-color': 'rgba(110,120,130,1)',
                            'line-width': 1
                        }
                    },
                    {
                        id: '構造物面',
                        type: 'fill',
                        source: 'bvmap',
                        'source-layer': 'StrctArea',
                        paint: {
                            'fill-color': 'rgba(0,0,0,0)',
                            'fill-outline-color': 'rgba(110,120,130,1)'
                        }
                    },
                    {
                        id: '構造物面の外周線',
                        type: 'line',
                        source: 'bvmap',
                        'source-layer': 'StrctArea',
                        paint: {
                            'line-color': 'rgba(110,120,130,1)',
                            'line-width': 1
                        }
                    },
                    {
                        id: '構造物線',
                        type: 'line',
                        source: 'bvmap',
                        'source-layer': 'StrctLine',
                        minzoom: 17,
                        paint: {
                            'line-color': 'rgba(110,120,130,1)',
                            'line-width': 1
                        }
                    },
                    {
                        id: '交通トンネル口',
                        type: 'line',
                        source: 'bvmap',
                        'source-layer': 'TrfTnnlEnt',
                        minzoom: 17,
                        paint: {
                            'line-color': 'rgba(110,120,130,1)',
                            'line-width': 1
                        }
                    },
                    {
                        id: '送電線',
                        type: 'line',
                        source: 'bvmap',
                        'source-layer': 'PwrTrnsmL',
                        paint: {
                            'line-color': 'rgba(110,120,130,1)',
                            'line-width': 1
                        }
                    }
                ],
                terrain: {
                    source: 'fusiTerrain'
                }
            }
        });

        // Add navigation controls
        map.addControl(new maplibregl.NavigationControl({
            visualizePitch: true,
            showZoom: true,
            showCompass: true
        }), 'top-right');

        // Add GSI attribution to map controls
        map.on('load', () => {
            const attributionControl = document.querySelector('.maplibregl-ctrl-attrib-inner');
            if (attributionControl && !attributionControl.innerHTML.includes('国土地理院')) {
                attributionControl.innerHTML += ' | データ: <a href="https://www.gsi.go.jp/" target="_blank" rel="noopener noreferrer">国土地理院 (GSI Japan)</a> R 6JHs 133';
            }
        });
    </script>
</body>

</html>
